name: Rename Directories

on:
  push:
    branches:
      - main  # Указывайте нужную ветку

jobs:
  rename-directories:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Для работы с историей

      - name: Install Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Add leading zeros to directory names
        run: |
          import os
          import re
          from git import Repo
      
          repo = Repo('.')
          assert not repo.bare
          dirs = []
          for root, dirnames, _ in os.walk('.'):
              for dirname in dirnames:
                  if re.match(r'^\d+-', dirname):
                      dirs.append(os.path.join(root, dirname))
      
          def add_leading_zeros(dirname):
              basename = os.path.basename(dirname)
              parts = basename.split('-')
              number = parts[0]
              padded_number = f'{int(number):03d}'  # Adjust zero-padding as needed
              new_dirname = padded_number + '-' + '-'.join(parts[1:])
              full_new_dirname = os.path.join(os.path.dirname(dirname), new_dirname)
              os.rename(dirname, full_new_dirname)
              return full_new_dirname
      
          for d in dirs:
              new_name = add_leading_zeros(d)
              repo.git.add(new_name)
              repo.git.rm(d)
      
          if dirs:
              repo.git.commit('-m', 'Automatically renamed directories to include leading zeros')
              repo.git.push()


        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
